<div class="ubcpi_block problem">

    <div class="revise" data-ng-controller="ReviseController as rc">

        <div class="question-other-explain" data-ng-if="rc.status() == rc.STATUS_NEW || rc.status() == rc.STATUS_ANSWERED">

            <h2 id="pi-question-h" class="question-text">Question:</h2>

            <img ng-src="{{question_text.image_url}}" alt="{{question_text.image_alt}}" ng-if="question_text.image_position == 'above' && question_text.image_url" />

            <pre aria-labelledby="pi-question-h" class="ubcpipre" ng-bind-html="question_text.text" ng-if="question_text.text"></pre>

            <img ng-src="{{question_text.image_url}}" alt="{{question_text.image_alt}}" ng-if="question_text.image_position == 'below' && question_text.image_url" />

            <div class="others-responses" data-ng-if="rc.status() == rc.STATUS_ANSWERED">

                <h3>Others' responses</h3>
                <p>Here is a selection of other students' answers. They may help you refine your answer.</p>

                <ul class="ubcpi-other-answers">
                    <li data-ng-repeat="answer in rc.other_answers.answers">
                        <!-- <h4 class="other-answer">Answer: {{options[answer.option]}}</h4> -->
                        <img ng-src="{{options[answer.option].image_url}}" alt="{{options[answer.option].image_alt}}" ng-if="options[answer.option].image_position == 'above' && options[answer.option].image_url" />

                        <h4 class="other-answer" ng-if="options[answer.option].text">Answer: {{options[answer.option].text}}</h4>

                        <img ng-src="{{options[answer.option].image_url}}" alt="{{options[answer.option].image_alt}}" ng-if="options[answer.option].image_position == 'below' && options[answer.option].image_url" />
                        <pre class="ubcpipre other-rationale">{{answer.rationale}}</pre>

                    </li>
                </ul>

                <h3>If you wish, you may now revise your answer.</h3>
                <p>Now that you have seen a selection of others' responses, you have the option to alter your initial selection.</p>

            </div><!-- .others-responses -->

            <form name="answerForm" class="choicegroup your-answer-and-rationale">

                <fieldset role="radiogroup">
                    <legend>Your Response <span class="inline-hint" ng-if="rc.status() == rc.STATUS_NEW">(You may change this response if you wish in the next step)</span></legend>
                    <label class="ubcpi-label ubcpi-answer" data-ng-repeat="option in options track by $index">
                        <input class="ubcpi-field" type="radio"  name="q" data-ng-model="rc.answer" value="{{$index}}" integer>

                        <img ng-src="{{option.image_url}}" alt="{{option.image_alt}}" ng-if="option.image_position == 'above' && option.image_url" />

                        <p ng-if="option.text">{{option.text}} <span class="chosen-option option-details-text" ng-if="rc.answer == $index && rc.status() == rc.STATUS_ANSWERED">(You chose this option initially)</span></p>

                        <img ng-src="{{option.image_url}}" alt="{{option.image_alt}}" ng-if="option.image_position == 'below' && option.image_url" />

                    </label>
                </fieldset>

                <label class="ubcpi-label" for="{{appId}}_rationale">Please explain your selection <span class="inline-hint" data-ng-if="rc.status() == rc.STATUS_ANSWERED">(Your original rationale is entered here and you may change it if you wish)</span></label>
                <textarea class="ubcpi-field ubcpi-rationale" id="{{appId}}_rationale" name="rationale" data-ng-model="rc.rationale" required></textarea>

                <input data-ng-disabled="answerForm.$invalid || rc.disableSubmit()" type='button' class='ubcpi_submit' value='Next Step' name='ubcpi_next_step' data-ng-click="rc.clickSubmit($event)" />
                <span role="alert" class="inline-hint" ng-if="rc.status() == rc.STATUS_NEW"><i class="icon fa fa-info-circle"></i> In the next step you will be shown a selection of other responses which may help you refine your answer.</span>
                <span role="alert" class="inline-hint" ng-if="rc.status() == rc.STATUS_ANSWERED"><i class="icon fa fa-info-circle"></i> The next - and final - step is where you will be shown the correct answer and rationale.</span>
                <br />

                <div class="message has-warnings warning-notice option-details-text" data-ng-if="answerForm.$invalid || rc.disableSubmit()">
                    <p role="alert" class="warning">
                        <i class="icon fa fa-warning"></i>
                        Note: In order to move to the next step please choose an answer and explain your decision.
                    </p>
                </div

            </form>

        </div><!-- .question-other-explain -->

        <div class="correct-revised-chart" data-ng-if="rc.status() == rc.STATUS_REVISED" data-ng-init="rc.getStats()">

            <section class="solution-span correct-answer-and-rationale">

                <span>
                    <div class="detailed-solution">
                        <h2>Correct Option: <span class="correct-option">Option {{rc.correct_answer + 1}}</span></h2>

                        <img ng-src="{{options[rc.correct_answer].image_url}}" alt="{{options[rc.correct_answer].image_alt}}" ng-if="options[rc.correct_answer].image_position == 'above' && options[rc.correct_answer].image_url" />

                        <h3 class="correct-answer-option" ng-if="options[rc.correct_answer].text">{{options[rc.correct_answer].text}}</h3>

                        <img ng-src="{{options[rc.correct_answer].image_url}}" alt="{{options[rc.correct_answer].image_alt}}" ng-if="options[rc.correct_answer].image_position == 'below' && options[rc.correct_answer].image_url" />

                        <h2>Correct Option Rationale:</h2>
                        <pre class="ubcpipre">{{rc.correct_rationale.text}}</pre>
                    </div><!-- .detailed-solution -->
                </span>

            </section><!-- .correct-answer-and-rationale -->

            <div class="original-answers results-container choicegroup">

                <fieldset role="radiogroup">
                    <legend>Original Answers</legend>
                    <label class="ubcpi-label ubcpi-answer" data-ng-repeat="d in chartDataOriginal[0]['values'] track by $index">
                        <input class="ubcpi-field" type="radio" data-ng-model="rc.answer_original" value="{{$index}}" disabled>

                        <div><span class="possible-option">Option {{$index + 1}}</span> <span ng-if="rc.correct_answer == $index" class="correct-option option-details-text">Correct Option</span> <span class="chosen-option option-details-text" ng-if="rc.answer_original == $index">(You chose this option initially)</span></div>

                        <img ng-src="{{d[0].image_url}}" alt="{{d[0].image_alt}}" ng-if="d[0].image_position == 'above' && d[0].image_url" />

                        <div ng-if="d[0].text" class="original-response response-text">{{d[0].text}}</div>

                        <img ng-src="{{d[0].image_url}}" alt="{{d[0].image_alt}}" ng-if="d[0].image_position == 'below' && d[0].image_url" />
                    </label>
                </fieldset>

                <div id="original-bar-chart"></div>

            </div><!-- .original-answers -->

            <div class="revised-answers results-container choicegroup">

                <fieldset role="radiogroup">
                    <legend>Revised Answers</legend>
                    <label class="ubcpi-label ubcpi-answer" data-ng-repeat="d in chartDataRevised[0]['values'] track by $index">
                        <input class="ubcpi-field" type="radio" data-ng-model="rc.answer_revised" value="{{$index}}" disabled>

                        <div><span class="possible-option">Option {{$index + 1}}</span> <span ng-if="rc.correct_answer == $index" class="correct-option option-details-text">Correct Option</span> <span class="chosen-option option-details-text" ng-if="rc.answer_revised == $index">(You chose this option after seeing others)</span></div>

                        <img ng-src="{{d[0].image_url}}" alt="{{d[0].image_alt}}" ng-if="d[0].image_position == 'above' && d[0].image_url" />

                        <div ng-if="d[0].text" class="revised-response response-text">{{d[0].text}}</div>

                        <img ng-src="{{d[0].image_url}}" alt="{{d[0].image_alt}}" ng-if="d[0].image_position == 'below' && d[0].image_url" />
                    </label>
                </fieldset>

                <div id="revised-bar-chart"></div>

            </div><!-- .revised-answers -->

        </div><!-- .correct-revised-chart -->

    </div><!-- .revise -->

</div><!-- .ubcpi_block -->
